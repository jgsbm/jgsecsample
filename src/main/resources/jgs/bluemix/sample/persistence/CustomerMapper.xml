<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jgs.bluemix.sample.persistence.CustomerMapper">

    <cache/>
    
    <select id="findCustomerByMail" resultType="jgs.bluemix.sample.entity.Customer">
        SELECT
          id,
          customer_name,
          address,
          tel,
          hashed_password,
          email,
          created_at,
          updated_at,
          version
        FROM
          customers
        WHERE
          email = #{email}
    </select>

    <insert id="insertCustomer" parameterType="jgs.bluemix.sample.entity.Customer" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        INSERT INTO customers (
          customer_name,
          address,
          tel,
          hashed_password,
          email,
          created_at,
          updated_at,
          version)
        VALUES (
          #{customerName},
          #{address},
          #{tel},
          #{hashedPassword},
          #{email},
          current_timestamp(),
          current_timestamp(),
          1
        )
    </insert>

    <insert id="insertCreditCard" parameterType="jgs.bluemix.sample.entity.CreditCard" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        INSERT INTO creditcards (
          encrypted_creditno,
          customer_id,
          created_at,
          updated_at,
          version)
        VALUES (
          #{encryptedCreditno},
          #{customer.id},
          current_timestamp(),
          current_timestamp(),
          1
        )
    </insert>

</mapper>